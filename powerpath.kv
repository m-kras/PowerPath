#:import Factory kivy.factory.Factory
#:import sp kivy.metrics.sp


<Button>:
    font_name: "data/Parkinsans.ttf"

<Label>:
    font_name: "data/Parkinsans.ttf"

<Spinner>:
    font_name: "data/Parkinsans.ttf"

<TextInput>:
    font_name: "data/Parkinsans.ttf"


<MyScreenManager>:

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size


<HomeScreen>:

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Button:
            text: "How to..."
            font_size: root.width * 0.02
            size_hint: 0.17, 0.05
            pos_hint: {"center_x": 0.9, "center_y": 0.92}
            on_press:
                root.manager.transition.direction = "left"
                app.root.current = "howto"

        Label:
            text: "PowerPath"
            font_name: "data/Parkinsans-Bold.ttf"
            font_size: root.width * 0.1
            pos_hint: {"center_x": 0.5, "center_y": 0.85}

        Label:
            text: "It's about Progress"
            font_name: "data/Montserrat-MediumItalic"
            font_size: root.width * 0.04
            italic: True
            pos_hint: {"center_x": 0.5, "center_y": 0.8}

        Button:
            text: "Manage Plans"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.1
            pos_hint: {"center_x": 0.5, "center_y": 0.57}
            on_press:
                root.manager.transition.direction = "left"
                app.root.current = "manage"

        Button:
            text: "New Session"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.1
            pos_hint: {"center_x": 0.5, "center_y": 0.37}
            on_press:
                root.manager.transition.direction = "left"
                app.root.current = "startsession"

        Button:
            text: "Past Workouts"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.1
            pos_hint: {"center_x": 0.5, "center_y": 0.17}
            on_press:
                root.manager.transition.direction = "left"
                app.root.current = "past"


<HowToScreen>:

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    ScrollView:
        BoxLayout:

            orientation: "vertical"
            size_hint_y: None
            size_hint_x: None
            height: self.minimum_height
            width: root.width
            spacing: "45sp"
            padding: "30sp"

            Button:
                text: "Back"
                font_size: root.width * 0.03
                size_hint_x: 0.3
                size_hint_y: None
                pos_hint: {"x": 0.01}
                height: "45sp"
                on_press:
                    root.manager.transition.direction = "right"
                    app.root.current = "home"

            Label:
                text: "How to..."
                font_size: root.width * 0.07
                size_hint_y: None

            Label:
                text: "-> Add a new workout plan:\n     1. Go to: 'Manage Plans' > 'Add Plan'\n     2. Enter plan's name and your exercises\n     3. Save"
                font_size: root.width * 0.03
                text_size: self.width, None
                halign: "left"
                valign: "top"
                height: self.texture_size[1]
                size_hint_x: 1
                size_hint_y: None

            Label:
                text: "-> Delete a workout plan:\n     1. Go to: 'Manage Plans' > 'Delete Plan'\n     2. Select a plan to delete\n     3. Confirm"
                font_size: root.width * 0.03
                text_size: self.width, None
                halign: "left"
                valign: "top"
                height: self.texture_size[1]
                size_hint_x: 1
                size_hint_y: None

            Label:
                text: "-> Start a new session:\n     1. Go to: 'New Session'\n     2. Select one of your saved workouts\n     3. Change the date if needed\n     4. Start\n     5. Enter weight + reps for every set\n     6. Add a workout comment if needed and save"
                font_size: root.width * 0.03
                text_size: self.width, None
                halign: "left"
                valign: "top"
                height: self.texture_size[1]
                size_hint_x: 1
                size_hint_y: None

            Label:
                text: "-> Check your progress:\n     1. Go to: 'Past Workouts'\n     2. Select one of your saved workouts\n     3. Press 'Show'"
                font_size: root.width * 0.03
                text_size: self.width, None
                halign: "left"
                valign: "top"
                height: self.texture_size[1]
                size_hint_x: 1
                size_hint_y: None

            Label:
                text: "-> Edit or delete Workouts:\n     1. Go to: 'Past Workouts'\n     2. Select one of your saved workouts\n     3. Press 'Make Changes'\n     4. Select a date\n     5. Edit the workout (Confirm the weight/rep values by adding the set or change the values if needed) OR delete the workout"
                font_size: root.width * 0.03
                text_size: self.width, None
                halign: "left"
                valign: "top"
                height: self.texture_size[1]
                size_hint_x: 1
                size_hint_y: None


<ManageScreen>:

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Label:
            text: "Manage Plans"
            font_size: root.width * 0.07
            pos_hint: {"center_x": 0.5, "center_y": 0.85}

        Button:
            text: "Add Plan"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.1
            pos_hint: {"center_x": 0.5, "center_y": 0.55}
            on_press:
                root.manager.transition.direction = "left"
                app.root.current = "addplan"

        Button:
            text: "Delete Plan"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.1
            pos_hint: {"center_x": 0.5, "center_y": 0.35}
            on_press:
                root.manager.transition.direction = "left"
                app.root.current = "delplan"

        Button:
            text: "Back"
            font_size: root.width * 0.03
            size_hint: 0.3, 0.07
            pos_hint: {"x": 0.65, "y": 0.07}
            on_press:
                root.manager.transition.direction = "right"
                app.root.current = "home"


<AddPlanScreen>:

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Label:
            text: "Add Plan"
            font_size: root.width * 0.07
            pos_hint: {"center_x": 0.5, "center_y": 0.9}

        TextInput:
            id: name_input
            hint_text: "Name of your Plan"
            font_size: root.width * 0.045
            bold: True
            size_hint: 0.7, 0.065
            pos_hint: {"center_x": 0.5, "center_y": 0.77}

        TextInput:
            id: exercise_input
            font_size: root.width * 0.045
            size_hint: 0.7, 0.065
            pos_hint: {"center_x": 0.5, "center_y": 0.62}

        Button:
            text: "Add Exercise"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.08
            pos_hint: {"center_x": 0.5, "center_y": 0.45}
            on_press: root.add_exercise()

        Label:
            id: feedback_label
            font_size: root.width * 0.03
            size_hint: 0.4, 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.38}

        Button:
            text: "Save Plan"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.1
            pos_hint: {"center_x": 0.5, "center_y": 0.3}
            background_color: 0, 0.5, 0.7, 1
            background_normal: ""
            on_press:
                root.save_plan()

        Button:
            text: "Cancel"
            font_size: root.width * 0.03
            size_hint: 0.3, 0.07
            pos_hint: {"x": 0.65, "y": 0.07}
            on_press:
                root.open_popup()


<DelPlanScreen>:

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Label:
            text: "Delete Plan"
            font_size: root.width * 0.07
            pos_hint: {"center_x": 0.5, "center_y": 0.9}

        Spinner:
            id: delplan_spinner
            text: "Select Plan"
            font_size: root.width * 0.04
            size_hint: 0.7, 0.08
            pos_hint: {"center_x": 0.5, "center_y": 0.75}

        Label:
            id: feedback_label
            font_size: root.width * 0.03
            size_hint: 0.4, 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.4}

        Button:
            text: "Delete"
            font_size: root.width * 0.04
            background_color: 1, 0, 0, 1
            background_normal: ""
            size_hint: 0.5, 0.1
            pos_hint: {"center_x": 0.5, "center_y": 0.3}
            on_press: root.open_popup()

        Button:
            text: "Back"
            font_size: root.width * 0.03
            size_hint: 0.3, 0.07
            pos_hint: {"x": 0.65, "y": 0.07}
            on_press:
                root.manager.transition.direction = "right"
                app.root.current = "manage"


<StartSessionScreen>:
    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Label:
            text: "New Session"
            font_size: root.width * 0.07
            pos_hint: {"center_x": 0.5, "center_y": 0.9}

        Spinner:
            id: workout_spinner
            text: "Select Workout"
            font_size: root.width * 0.04
            size_hint: 0.75, 0.08
            pos_hint: {"center_x": 0.5, "center_y": 0.73}

        Label:
            text: "Date:"
            font_size: root.width * 0.04
            size_hint: 0.3, 0.08
            pos_hint: {"center_x": 0.16, "center_y": 0.58}

        TextInput:
            id: date_input
            font_size: root.width * 0.04
            size_hint: 0.5, 0.045
            pos_hint: {"center_x": 0.5, "center_y": 0.58}

        Button:
            text: "Start Session"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.1
            pos_hint: {"center_x": 0.5, "center_y": 0.4}
            background_color: 0, 0.5, 0.7, 1
            background_normal: ""
            on_press: root.start_session()

        Label:
            id: feedback_label
            font_size: root.width * 0.03
            size_hint: 0.4, 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.25}
            bold: True

        Button:
            text: "Back"
            font_size: root.width * 0.03
            size_hint: 0.3, 0.07
            pos_hint: {"x": 0.65, "y": 0.07}
            on_press:
                root.manager.transition.direction = "right"
                app.root.current = "home"


<SessionScreen>:
    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Label:
            id: date_label
            font_size: root.width * 0.02
            bold: True
            pos_hint: {"center_x": 0.88, "center_y": 0.94}

        Button:
            id: prev_btn
            text: "Previous Workout"
            font_size: root.width * 0.02
            italic: True
            size_hint: 0.25, 0.05
            pos_hint: {"center_x": 0.14, "center_y": 0.92}
            on_press: root.open_prev_popup()

        Label:
            id: exerset_label
            font_size: root.width * 0.05
            font_name: "data/Parkinsans-Bold.ttf"
            size_hint: 0.7, 0.15
            pos_hint: {"center_x": 0.5, "center_y": 0.87}

        TextInput:
            id: weight_input
            hint_text: "Weight in KG"
            font_size: root.width * 0.04
            size_hint: 0.65, 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.78}

        TextInput:
            id: reps_input
            hint_text: "Reps"
            font_size: root.width * 0.04
            size_hint: 0.65, 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.68}

        Label:
            id: feedback_label
            font_size: root.width * 0.03
            size_hint: 0.4, 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.6}
            bold: True

        Button:
            text: "Prev. Exercise"
            font_size: root.width * 0.032
            size_hint: 0.28, 0.1
            pos_hint: {"center_x": 0.15, "center_y": 0.49}
            on_press: root.prev_exercise()

        Button:
            text: "Add Set"
            font_size: root.width * 0.032
            size_hint: 0.28, 0.1
            pos_hint: {"center_x": 0.5, "center_y": 0.49}
            on_press: root.add_set()

        Button:
            text: "Next Exercise"
            font_size: root.width * 0.032
            size_hint: 0.28, 0.1
            pos_hint: {"center_x": 0.85, "center_y": 0.49}
            on_press: root.next_exercise()

        TextInput:
            id: comment_input
            hint_text: "Comment"
            font_name: "data/Montserrat-MediumItalic.ttf"
            font_size: root.width * 0.03
            size_hint: 0.5, 0.04
            pos_hint: {"center_x": 0.5, "center_y": 0.35}

        Button:
            text: "SAVE"
            font_size: root.width * 0.045
            size_hint: 0.55, 0.1
            pos_hint: {"center_x": 0.5, "center_y": 0.22}
            background_color: 0, 0.5, 0.7, 1
            background_normal: ""
            on_press: root.save_session()

        Button:
            text: "Cancel"
            font_size: root.width * 0.03
            size_hint: 0.3, 0.07
            pos_hint: {"x": 0.65, "y": 0.07}
            on_press: Factory.CancelPopup().open()


<PastScreen>:

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Button:
            text: "Back"
            font_size: root.width * 0.03
            size_hint: 0.25, 0.04
            pos_hint: {"center_x": 0.14, "center_y": 0.92}
            on_press:
                root.manager.transition.direction = "right"
                app.root.current = "home"

        Label:
            text: "Past Workouts"
            font_size: root.width * 0.07
            size_hint: 0.4, 0.08
            pos_hint: {"center_x": 0.5, "center_y": 0.86}

        Spinner:
            id: workout_spinner
            font_size: root.width * 0.04
            size_hint: 0.5, 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.78}

        Label:
            id: feedback_label
            font_size: root.width * 0.03
            bold: True
            size_hint: 0.6, 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.72}

        Button:
            text: "Show"
            font_size: root.width * 0.04
            size_hint: 0.4, 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.65}
            on_press: root.show_past_workouts()

        Button:
            text: "Make Changes"
            font_size: root.width * 0.04
            size_hint: 0.4, 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.58}
            on_press:
                if root.ids.workout_spinner.text != "Select Workout": root.edit_or_show(False)

        Spinner:
            id: date_spinner
            opacity: 0
            disabled: True
            font_size: root.width * 0.02
            size_hint: 0.4, 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.47}

        Button:
            id: edit_btn
            opacity: 0
            disabled: True
            text: "Edit"
            font_size: root.width * 0.02
            size_hint: 0.3, 0.04
            pos_hint: {"center_x": 0.5, "center_y": 0.35}
            background_color: 0, 0.5, 0.7, 1
            background_normal: ""
            on_press: root.switch_to_editor()

        Button:
            id: del_btn
            opacity: 0
            disabled: True
            text: "Delete"
            font_size: root.width * 0.02
            size_hint: 0.3, 0.04
            pos_hint: {"center_x": 0.5, "center_y": 0.23}
            background_color: 1, 0.3, 0, 1
            background_normal: ""
            on_press: root.open_delwrk_popup()

        RecycleView:
            id: main_rv
            size_hint_y: 0.5
            viewclass: "WorkoutLabel"

            RecycleBoxLayout:
                default_size: None, None
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'
                spacing: dp(10)

<WorkoutLabel@Label>:
    size_hint_y: None
    text_size: self.width, None
    font_name: "data/NotoSansMono.ttf"
    font_size: self.width * 0.018
    height: self.texture_size[1] + dp(10)
    halign: "center"
    valign: "middle"
    padding: dp(10), dp(10)


<CancelPopup@PopUp>:
    title: "Cancel"
    size_hint: 0.8, 0.7
    auto_dismiss: False

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Label:
            text: "Are you sure?"
            font_size: root.width * 0.05
            pos_hint: {"center_x": 0.5, "center_y": 0.85}

        Label:
            text: "(Input will not be saved.)"
            font_size: root.width * 0.03
            pos_hint: {"center_x": 0.5, "center_y": 0.75}

        Button:
            text: "Yes"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.2
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            on_press:
                root.dismiss()
                app.root.transition.direction = "right"
                app.root.current = "home"

        Button:
            text: "No"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.2
            pos_hint: {"center_x": 0.5, "center_y": 0.2}
            on_press: root.dismiss()


<DelWrkPopup@Popup>:
    title: "Delete Workout"
    size_hint: 0.8, 0.7
    auto_dismiss: False

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Label:
            text: "Delete this workout?"
            font_size: root.width * 0.05
            size_hint: 0.7, 0.08
            pos_hint: {"center_x": 0.5, "center_y": 0.85}

        Label:
            id: wrk_date_label
            font_size: root.width * 0.03
            pos_hint: {"center_x": 0.5, "center_y": 0.75}

        Button:
            text: "No"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.2
            pos_hint: {"center_x": 0.5, "center_y": 0.2}
            on_press: root.dismiss()

        Button:
            text: "Yes"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.2
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            on_press:
                root.del_workout()
                root.dismiss()
                app.root.transition.direction = "right"
                app.root.current = "home"


<DelPlanPopup@Popup>:
    title: "Delete Plan"
    size_hint: 0.8, 0.7
    auto_dismiss: False

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Label:
            text: "Are you sure?"
            font_size: root.width * 0.05
            size_hint: 0.7, 0.08
            pos_hint: {"center_x": 0.5, "center_y": 0.85}

        Label:
            text: "(All workout history will be deleted.)"
            font_size: root.width * 0.03
            pos_hint: {"center_x": 0.5, "center_y": 0.75}

        Button:
            text: "No"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.2
            pos_hint: {"center_x": 0.5, "center_y": 0.2}
            on_press: root.dismiss()

        Button:
            text: "Yes"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.2
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            on_press:
                root.del_plan()
                root.dismiss()
                app.root.transition.direction = "right"
                app.root.current = "home"


<PrevPopup@Popup>:
    title: "Previous Workout"
    size_hint: 0.8, 0.8
    auto_dismiss: False

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Label:
            id: prev_label
            font_name: "data/NotoSansMono.ttf"
            font_size: root.width * 0.027
            text_size: self.width, None
            bold: True
            halign: "center"
            valign: "top"
            height: self.texture_size[1]
            size_hint: 0.8, 0.8
            pos_hint: {"center_x": 0.5, "center_y": 0.6}

        Button:
            text: "Back"
            font_size: root.width * 0.025
            size_hint: 0.4, 0.1
            pos_hint: {"center_x": 0.8, "center_y": 0.1}
            on_press: root.dismiss()


<WarningPopup@Popup>:
    title: "Exit?"
    size_hint: 0.8, 0.8
    auto_dismiss: True

    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Label:
            text: "Exit app?"
            font_size: root.width * 0.05
            size_hint: 0.7, 0.08
            pos_hint: {"center_x": 0.5, "center_y": 0.85}

        Button:
            text: "No"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.2
            pos_hint: {"center_x": 0.5, "center_y": 0.2}
            on_press: root.dismiss()

        Button:
            text: "Yes"
            font_size: root.width * 0.04
            size_hint: 0.5, 0.2
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            on_press: app.stop()